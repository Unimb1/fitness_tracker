{% extends "base.html" %}

{% block title %}–ú–æ–∏ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è - –§–∏—Ç–Ω–µ—Å –¢—Ä–µ–∫–µ—Ä{% endblock %}

{% block content %}
<div class="custom-exercises-page">
    <div class="page-header">
        <h1>üí™ –ú–æ–∏ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è</h1>
        <a href="{{ url_for('add_custom_exercise') }}" class="btn-primary">
            <span>‚ûï</span>
            <span>–î–æ–±–∞–≤–∏—Ç—å —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ</span>
        </a>
    </div>

    {% if exercises_by_group %}
        <!-- –ü–æ–∏—Å–∫ –∏ —Ñ–∏–ª—å—Ç—Ä—ã -->
        <div class="filters-section">
            <div class="search-box">
                <input type="text" id="exercise-search" placeholder="üîç –ü–æ–∏—Å–∫ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π..." autocomplete="off">
            </div>
            <div class="filter-buttons">
                <button type="button" class="filter-btn active" data-filter="all">–í—Å–µ</button>
                <button type="button" class="filter-btn" data-filter="custom">–ú–æ–∏ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è</button>
                <button type="button" class="filter-btn" data-filter="standard">–°–∏—Å—Ç–µ–º–Ω—ã–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è</button>
            </div>
            <div class="filter-buttons muscle-groups">
                <button type="button" class="filter-btn" data-filter="–ì—Ä—É–¥—å">–ì—Ä—É–¥—å</button>
                <button type="button" class="filter-btn" data-filter="–†—É–∫–∏">–†—É–∫–∏</button>
                <button type="button" class="filter-btn" data-filter="–ü–ª–µ—á–∏">–ü–ª–µ—á–∏</button>
                <button type="button" class="filter-btn" data-filter="–ù–æ–≥–∏">–ù–æ–≥–∏</button>
                <button type="button" class="filter-btn" data-filter="–°–ø–∏–Ω–∞">–°–ø–∏–Ω–∞</button>
                <button type="button" class="filter-btn" data-filter="–ö–∞—Ä–¥–∏–æ">–ö–∞—Ä–¥–∏–æ</button>
            </div>
        </div>

        {% for muscle_group, group_exercises in exercises_by_group.items() %}
        <div class="exercises-section" data-group="{{ muscle_group }}">
            <h2 class="section-title">
                <span class="section-icon">{{ 'üí™' if muscle_group != '–ö–∞—Ä–¥–∏–æ' else 'üèÉ' }}</span>
                {{ muscle_group }}
                <span class="exercise-count">({{ group_exercises|length }})</span>
            </h2>
            <div class="exercises-grid">
                {% for exercise in group_exercises %}
                <div class="exercise-card-wrapper" 
                     data-exercise-id="{{ exercise.id if exercise.id else '' }}" 
                     data-exercise-name="{{ exercise.name|lower }}" 
                     data-exercise-group="{{ exercise.muscle_group }}"
                     data-exercise-type="{{ 'custom' if exercise.is_custom else 'standard' }}">
                    <div class="exercise-card">
                        <div class="exercise-header">
                            <h3>
                                {{ exercise.name }}
                                {% if not exercise.is_custom %}
                                    <span class="exercise-badge standard-badge" title="–°–∏—Å—Ç–µ–º–Ω–æ–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ">‚öôÔ∏è</span>
                                {% endif %}
                            </h3>
                            <div class="exercise-header-actions">
                                <a href="{{ url_for('add_custom_exercise', id=exercise.id if exercise.id else None, name=exercise.name if not exercise.id else None, standard='true' if not exercise.is_custom else 'false') }}" 
                                   class="edit-exercise-btn" 
                                   title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ" 
                                   aria-label="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                                        <path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/>
                                    </svg>
                                </a>
                                {% if exercise.is_custom %}
                                <button type="button" class="delete-exercise-btn" data-exercise-id="{{ exercise.id }}" title="–£–¥–∞–ª–∏—Ç—å —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ" aria-label="–£–¥–∞–ª–∏—Ç—å">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                                        <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
                                    </svg>
                                </button>
                                {% endif %}
                            </div>
                        </div>
                        <div class="exercise-info">
                            <div class="info-item">
                                <span class="info-label">MET:</span>
                                <span class="info-value">{{ exercise.met_value }}</span>
                            </div>
                            {% if exercise.description %}
                            <div class="exercise-description">
                                <p>{{ exercise.description[:100] }}{% if exercise.description|length > 100 %}...{% endif %}</p>
                            </div>
                            {% endif %}
                            <div class="exercise-actions">
                                <button type="button" class="action-btn use-exercise-btn" data-exercise-name="{{ exercise.name }}" title="–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–µ">
                                    <span>‚ûï</span>
                                    <span>–î–æ–±–∞–≤–∏—Ç—å –≤ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É</span>
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="exercise-delete-action">
                        <span>–£–¥–∞–ª–∏—Ç—å</span>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endfor %}
    {% else %}
        <div class="no-data">
            <div class="no-data-icon">üí™</div>
            <p>–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π.</p>
            <p class="no-data-hint">–°–æ–∑–¥–∞–π—Ç–µ —Å–≤–æ–∏ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è –¥–ª—è –±–æ–ª–µ–µ —É–¥–æ–±–Ω–æ–≥–æ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫</p>
        </div>
    {% endif %}
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —É–¥–∞–ª–µ–Ω–∏—è -->
<div id="delete-confirmation-modal" class="delete-confirmation-modal">
    <div class="delete-confirmation-content">
        <h3>üóëÔ∏è –£–¥–∞–ª–∏—Ç—å —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ?</h3>
        <p>–≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å. –£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ –±—É–¥–µ—Ç —É–¥–∞–ª–µ–Ω–æ –∏–∑ –≤—Å–µ—Ö –≤–∞—à–∏—Ö —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫.</p>
        <div class="delete-confirmation-buttons">
            <button id="confirm-delete-btn" class="btn-confirm-delete" type="button">–£–¥–∞–ª–∏—Ç—å</button>
            <button id="cancel-delete-btn" class="btn-cancel-delete" type="button">–û—Ç–º–µ–Ω–∞</button>
        </div>
    </div>
</div>

<style>
.custom-exercises-page {
    max-width: 1200px;
    margin: 0 auto;
    padding: 1rem;
}

.page-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 2rem;
    flex-wrap: wrap;
    gap: 1rem;
}

.page-header h1 {
    font-size: 2rem;
    font-weight: 800;
    color: var(--text-primary);
    margin: 0;
    background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

.page-header .btn-primary {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.875rem 1.5rem;
    text-decoration: none;
    pointer-events: auto;
    cursor: pointer;
    z-index: 1;
    position: relative;
}

/* –§–∏–ª—å—Ç—Ä—ã –∏ –ø–æ–∏—Å–∫ */
.filters-section {
    background: var(--card-bg);
    padding: 1.5rem;
    border-radius: var(--radius-lg);
    box-shadow: var(--shadow-md);
    border: 1px solid var(--border-color);
    margin-bottom: 2rem;
}

.search-box {
    margin-bottom: 1rem;
}

.search-box input {
    width: 100%;
    padding: 0.875rem 1rem;
    border: 2px solid var(--border-color);
    border-radius: var(--radius-md);
    font-size: 1rem;
    transition: var(--transition);
    background: var(--light-bg);
    color: var(--text-primary);
    min-height: var(--touch-target-min);
    pointer-events: auto;
}

.search-box input:focus {
    outline: none;
    border-color: var(--primary-color);
    box-shadow: 0 0 0 3px rgba(17, 24, 39, 0.1);
    background: white;
}

.filter-buttons {
    display: flex;
    gap: 0.5rem;
    flex-wrap: wrap;
    margin-bottom: 0.75rem;
}

.filter-buttons.muscle-groups {
    margin-bottom: 0;
    padding-top: 0.75rem;
    border-top: 1px solid var(--border-color);
}

.filter-btn {
    background: var(--light-bg);
    border: 2px solid var(--border-color);
    border-radius: var(--radius-md);
    padding: 0.75rem 1.25rem;
    font-size: 0.9rem;
    font-weight: 600;
    color: var(--text-primary);
    cursor: pointer;
    transition: var(--transition);
    min-height: var(--touch-target-min);
    pointer-events: auto;
    z-index: 1;
    position: relative;
}

.filter-btn:hover {
    border-color: var(--primary-color);
    background: white;
}

.filter-btn.active {
    background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
    color: white;
    border-color: var(--primary-color);
}

.filter-btn:active {
    transform: scale(0.95);
}

.exercises-section {
    margin-bottom: 2.5rem;
}

.section-title {
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--text-primary);
    margin-bottom: 1.5rem;
    padding-bottom: 0.75rem;
    border-bottom: 3px solid var(--primary-color);
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.section-icon {
    font-size: 1.75rem;
}

.exercise-count {
    font-size: 1rem;
    color: var(--text-secondary);
    font-weight: 500;
    margin-left: auto;
}

.exercises-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 1.5rem;
}

.exercise-card-wrapper {
    position: relative;
    overflow: hidden;
    border-radius: var(--radius-lg);
    touch-action: pan-y;
    user-select: none;
    -webkit-user-select: none;
}

.exercise-card {
    background: linear-gradient(135deg, #f8fafc, white);
    padding: 1.5rem;
    border-radius: var(--radius-lg);
    border: 2px solid var(--border-color);
    transition: var(--transition);
    position: relative;
    overflow: hidden;
    box-shadow: var(--shadow-md);
    cursor: pointer;
    pointer-events: auto;
    z-index: 1;
}

.exercise-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 4px;
    height: 100%;
    background: var(--primary-color);
    transition: var(--transition);
}

.exercise-card:hover {
    transform: translateY(-3px);
    box-shadow: var(--shadow-lg);
    border-color: var(--primary-color);
}

.exercise-card:active {
    transform: translateY(-1px);
}

.exercise-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 1rem;
    gap: 1rem;
}

.exercise-header h3 {
    margin: 0;
    color: var(--text-primary);
    font-size: 1.1rem;
    font-weight: 700;
    flex: 1;
    line-height: 1.3;
}

.exercise-header-actions {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    flex-shrink: 0;
}

.edit-exercise-btn {
    background: transparent;
    border: none;
    color: var(--text-secondary);
    cursor: pointer;
    padding: 0.5rem;
    border-radius: var(--radius-sm);
    transition: var(--transition);
    display: flex;
    align-items: center;
    justify-content: center;
    width: 36px;
    height: 36px;
    min-height: 36px;
    min-width: 36px;
    pointer-events: auto;
    z-index: 10;
    position: relative;
    text-decoration: none;
}

.edit-exercise-btn:hover {
    background: rgba(59, 130, 246, 0.1);
    color: var(--primary-color);
    transform: scale(1.1);
}

.edit-exercise-btn:active {
    transform: scale(0.95);
}

.delete-exercise-btn {
    background: transparent;
    border: none;
    color: var(--text-secondary);
    cursor: pointer;
    padding: 0.5rem;
    border-radius: var(--radius-sm);
    transition: var(--transition);
    display: flex;
    align-items: center;
    justify-content: center;
    width: 36px;
    height: 36px;
    min-height: 36px;
    min-width: 36px;
    pointer-events: auto;
    z-index: 10;
    position: relative;
    flex-shrink: 0;
}

.delete-exercise-btn:hover {
    background: rgba(239, 68, 68, 0.1);
    color: var(--error-color);
    transform: scale(1.1);
}

.delete-exercise-btn:active {
    transform: scale(0.95);
}

.exercise-badge {
    display: inline-block;
    font-size: 0.75rem;
    margin-left: 0.5rem;
    opacity: 0.7;
}

.standard-badge {
    font-size: 0.85rem;
}

.exercise-info {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
}

.info-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.75rem;
    background: white;
    border-radius: var(--radius-sm);
    border: 1px solid var(--border-color);
}

.info-label {
    font-weight: 600;
    color: var(--text-secondary);
    font-size: 0.9rem;
}

.info-value {
    font-weight: 700;
    color: var(--text-primary);
    font-size: 1.1rem;
}

.exercise-description {
    margin-top: 0.5rem;
    padding: 0.75rem;
    background: white;
    border-radius: var(--radius-sm);
    border-left: 3px solid var(--primary-color);
}

.exercise-description p {
    margin: 0;
    color: var(--text-secondary);
    font-size: 0.9rem;
    line-height: 1.5;
}

.exercise-actions {
    margin-top: 0.5rem;
}

.action-btn {
    width: 100%;
    background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
    color: white;
    border: none;
    border-radius: var(--radius-md);
    padding: 0.75rem;
    font-size: 0.9rem;
    font-weight: 600;
    cursor: pointer;
    transition: var(--transition);
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    min-height: var(--touch-target-min);
    pointer-events: auto;
    z-index: 2;
    position: relative;
}

.action-btn:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-md);
}

.action-btn:active {
    transform: translateY(0);
}

/* –°–≤–∞–π–ø –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è */
.exercise-delete-action {
    position: absolute;
    right: 0;
    top: 0;
    bottom: 0;
    width: 80px;
    background: linear-gradient(135deg, #ef4444, #dc2626);
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 1rem;
    font-weight: bold;
    z-index: 2;
    transform: translateX(100%);
    transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    border-radius: 0 var(--radius-lg) var(--radius-lg) 0;
    box-shadow: -2px 0 8px rgba(0, 0, 0, 0.2);
}

.exercise-delete-action.show {
    transform: translateX(0);
}

.exercise-card.swiping {
    transition: transform 0.1s ease-out;
}

.exercise-card.swiping-delete {
    transform: translateX(-100%);
    opacity: 0;
}

/* –°–∫—Ä—ã—Ç–∏–µ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –ø—Ä–∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ */
.exercises-section.hidden,
.exercise-card-wrapper.hidden {
    display: none;
}

.no-data {
    text-align: center;
    padding: 3rem 1rem;
    background: var(--card-bg);
    border-radius: var(--radius-xl);
    box-shadow: var(--shadow-md);
    border: 2px dashed var(--border-color);
}

.no-data-icon {
    font-size: 4rem;
    margin-bottom: 1rem;
}

.no-data p {
    color: var(--text-secondary);
    font-size: 1.1rem;
    margin-bottom: 0.5rem;
}

.no-data-hint {
    font-size: 0.9rem;
    color: var(--text-secondary);
    margin-bottom: 2rem;
}

.no-data .btn-primary {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    text-decoration: none;
    pointer-events: auto;
    cursor: pointer;
    z-index: 1;
    position: relative;
}

@media (max-width: 768px) {
    .exercises-grid {
        grid-template-columns: 1fr;
    }
    
    .page-header {
        flex-direction: column;
        align-items: stretch;
    }
    
    .page-header h1 {
        font-size: 1.5rem;
    }
    
    .filter-buttons {
        justify-content: center;
    }
    
    .filter-btn {
        flex: 1;
        min-width: calc(33.333% - 0.4rem);
    }
}

@media (max-width: 480px) {
    .filter-btn {
        min-width: calc(50% - 0.25rem);
        font-size: 0.85rem;
        padding: 0.65rem 0.75rem;
    }
}
</style>

<script src="{{ url_for('static', filename='swipe-delete.js') }}"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    const deleteModal = document.getElementById('delete-confirmation-modal');
    const confirmDeleteBtn = document.getElementById('confirm-delete-btn');
    const cancelDeleteBtn = document.getElementById('cancel-delete-btn');
    const searchInput = document.getElementById('exercise-search');
    const filterButtons = document.querySelectorAll('.filter-btn');
    let exerciseToDelete = null;
    
    // –ü–æ–∏—Å–∫ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π
    if (searchInput) {
        searchInput.addEventListener('input', function() {
            const searchTerm = this.value.toLowerCase().trim();
            filterExercises(searchTerm, currentTypeFilter, currentGroupFilter);
        });
    }
    
    // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Ç–∏–ø—É (–í—Å–µ / –ú–æ–∏ / –°–∏—Å—Ç–µ–º–Ω—ã–µ) –∏ –≥—Ä—É–ø–ø–∞–º –º—ã—à—Ü
    filterButtons.forEach(btn => {
        btn.addEventListener('click', function() {
            const filter = this.dataset.filter;
            const searchTerm = searchInput ? searchInput.value.toLowerCase().trim() : '';
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º, —ç—Ç–æ —Ñ–∏–ª—å—Ç—Ä —Ç–∏–ø–∞ –∏–ª–∏ –≥—Ä—É–ø–ø—ã –º—ã—à—Ü
            if (filter === 'all' || filter === 'custom' || filter === 'standard') {
                // –§–∏–ª—å—Ç—Ä —Ç–∏–ø–∞ - —É–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —É –≤—Å–µ—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤ —Ç–∏–ø–∞
                document.querySelectorAll('.filter-buttons:not(.muscle-groups) .filter-btn').forEach(b => {
                    b.classList.remove('active');
                });
                // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é
                this.classList.add('active');
                
                const typeFilter = filter === 'all' ? null : filter;
                currentTypeFilter = typeFilter;
                filterExercises(searchTerm, typeFilter, currentGroupFilter);
            } else {
                // –§–∏–ª—å—Ç—Ä –≥—Ä—É–ø–ø—ã –º—ã—à—Ü - —É–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —É –≤—Å–µ—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤ –≥—Ä—É–ø–ø
                document.querySelectorAll('.muscle-groups .filter-btn').forEach(b => {
                    b.classList.remove('active');
                });
                // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é
                this.classList.add('active');
                
                const groupFilter = filter === 'all' ? null : filter;
                currentGroupFilter = groupFilter;
                filterExercises(searchTerm, currentTypeFilter, groupFilter);
            }
        });
    });
    
    let currentTypeFilter = 'all';
    let currentGroupFilter = null;
    
    function filterExercises(searchTerm, typeFilter, groupFilter) {
        // –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º —Ñ–∏–ª—å—Ç—Ä—ã
        if (typeFilter === 'all' || typeFilter === null) {
            typeFilter = null;
        }
        if (groupFilter === 'all' || groupFilter === null) {
            groupFilter = null;
        }
        const cards = document.querySelectorAll('.exercise-card-wrapper');
        const sections = document.querySelectorAll('.exercises-section');
        
        currentTypeFilter = typeFilter;
        currentGroupFilter = groupFilter;
        
        let visibleCount = 0;
        
        cards.forEach(card => {
            const name = card.dataset.exerciseName || '';
            const group = card.dataset.exerciseGroup || '';
            const type = card.dataset.exerciseType || '';
            const section = card.closest('.exercises-section');
            
            const matchesSearch = !searchTerm || name.includes(searchTerm);
            const matchesType = !typeFilter || 
                (typeFilter === 'custom' && type === 'custom') ||
                (typeFilter === 'standard' && type === 'standard');
            const matchesGroup = !groupFilter || group === groupFilter;
            
            if (matchesSearch && matchesType && matchesGroup) {
                card.classList.remove('hidden');
                if (section) section.classList.remove('hidden');
                visibleCount++;
            } else {
                card.classList.add('hidden');
            }
        });
        
        // –°–∫—Ä—ã–≤–∞–µ–º —Å–µ–∫—Ü–∏–∏ –±–µ–∑ –≤–∏–¥–∏–º—ã—Ö —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π
        sections.forEach(section => {
            const visibleCards = section.querySelectorAll('.exercise-card-wrapper:not(.hidden)');
            if (visibleCards.length === 0) {
                section.classList.add('hidden');
            } else {
                section.classList.remove('hidden');
            }
        });
    }
    
    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∏–∫–∞ –Ω–∞ –∫–Ω–æ–ø–∫—É —É–¥–∞–ª–µ–Ω–∏—è
    document.querySelectorAll('.delete-exercise-btn').forEach(btn => {
        btn.addEventListener('click', function(e) {
            e.stopPropagation();
            exerciseToDelete = this.dataset.exerciseId;
            deleteModal.classList.add('show');
        });
    });
    
    // –ö–Ω–æ–ø–∫–∞ "–î–æ–±–∞–≤–∏—Ç—å –≤ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É"
    document.querySelectorAll('.use-exercise-btn').forEach(btn => {
        btn.addEventListener('click', function(e) {
            e.stopPropagation();
            const exerciseName = this.dataset.exerciseName;
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ localStorage –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ —Ñ–æ—Ä–º–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏
            localStorage.setItem('selectedExercise', exerciseName);
            // –ü–µ—Ä–µ—Ö–æ–¥–∏–º –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏
            window.location.href = '{{ url_for("add_workout_session") }}';
        });
    });
    
    // –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–∏—è
    confirmDeleteBtn.addEventListener('click', function() {
        if (exerciseToDelete) {
            window.location.href = `/delete-custom-exercise/${exerciseToDelete}`;
        }
    });
    
    // –û—Ç–º–µ–Ω–∞ —É–¥–∞–ª–µ–Ω–∏—è
    cancelDeleteBtn.addEventListener('click', function() {
        deleteModal.classList.remove('show');
        exerciseToDelete = null;
    });
    
    // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ –∫–ª–∏–∫—É –≤–Ω–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
    deleteModal.addEventListener('click', function(e) {
        if (e.target === deleteModal) {
            deleteModal.classList.remove('show');
            exerciseToDelete = null;
        }
    });
});
</script>
{% endblock %}
