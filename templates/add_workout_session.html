{% extends "base.html" %}

{% block title %}–î–æ–±–∞–≤–∏—Ç—å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É - –§–∏—Ç–Ω–µ—Å –¢—Ä–µ–∫–µ—Ä{% endblock %}

{% block content %}
<div class="form-container">
    <h2>–î–æ–±–∞–≤–∏—Ç—å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É</h2>

    <form method="POST" id="workout-session-form">
        <div class="form-group">
            <label for="date">–î–∞—Ç–∞ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏:</label>
            <input type="date" id="date" name="date" value="{{ today }}" required>
        </div>

        <div class="form-group">
            <label for="workout_name">–ù–∞–∑–≤–∞–Ω–∏–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏:</label>
            <input type="text" id="workout_name" name="workout_name" placeholder="–û—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –Ω–∞–∑–≤–∞–Ω–∏—è">
        </div>

        <div class="form-group">
            <label for="duration_minutes">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ (–º–∏–Ω—É—Ç—ã):</label>
            <input type="number" id="duration_minutes" name="duration_minutes" min="0" step="1" placeholder="–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è">
        </div>

        <div class="form-group">
            <label for="default_rest_time">–í—Ä–µ–º—è –æ—Ç–¥—ã—Ö–∞ –º–µ–∂–¥—É –ø–æ–¥—Ö–æ–¥–∞–º–∏ (—Å–µ–∫—É–Ω–¥—ã):</label>
            <input type="number" id="default_rest_time" name="default_rest_time" min="30" max="300" value="90">
        </div>

        <div id="exercises-container">
            <div class="exercise-form" data-exercise-index="0">
                <div class="exercise-header">
                    <h4>–£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ 1</h4>
                    <button type="button" class="btn-remove-exercise remove-exercise-btn" style="display: none;" title="–£–¥–∞–ª–∏—Ç—å —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
                        </svg>
                    </button>
                </div>
                
                <div class="exercise-controls">
                    <button type="button" class="btn-small btn-info get-suggestion-btn" data-exercise-index="0">
                        üí° –ü—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ –≤–µ—Å–∞
                    </button>
                </div>
                
                <div class="form-group">
                    <label>–£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ:</label>
                    <select name="exercise_type_0" class="exercise-select" required>
                        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ</option>
                        <optgroup label="–ì—Ä—É–¥—å">
                            <option value="–ñ–∏–º –ª–µ–∂–∞">–ñ–∏–º –ª–µ–∂–∞</option>
                            <option value="–°–≤–µ–¥–µ–Ω–∏–µ —Ä—É–∫ –≤ –∫—Ä–æ—Å—Å–æ–≤–µ—Ä–µ –Ω–∞ –≥—Ä—É–¥—å">–°–≤–µ–¥–µ–Ω–∏–µ —Ä—É–∫ –≤ –∫—Ä–æ—Å—Å–æ–≤–µ—Ä–µ –Ω–∞ –≥—Ä—É–¥—å</option>
                        </optgroup>
                        <optgroup label="–†—É–∫–∏">
                            <option value="–†–∞–∑–≥–∏–±–∞–Ω–∏—è –Ω–∞ —Ç—Ä–∏—Ü–µ–ø—Å —Å –∫–∞–Ω–∞—Ç–Ω–æ–π —Ä—É–∫–æ—è—Ç—å—é –≤ –∫—Ä–æ—Å—Å–æ–≤–µ—Ä–µ">–†–∞–∑–≥–∏–±–∞–Ω–∏—è –Ω–∞ —Ç—Ä–∏—Ü–µ–ø—Å —Å –∫–∞–Ω–∞—Ç–Ω–æ–π —Ä—É–∫–æ—è—Ç—å—é –≤ –∫—Ä–æ—Å—Å–æ–≤–µ—Ä–µ</option>
                            <option value="–°–≥–∏–±–∞–Ω–∏—è –Ω–∞ –±–∏—Ü–µ–ø—Å –≤ —Ä—ã—á–∞–∂–Ω–æ–º —Ç—Ä–µ–Ω–∞–∂–µ—Ä–µ">–°–≥–∏–±–∞–Ω–∏—è –Ω–∞ –±–∏—Ü–µ–ø—Å –≤ —Ä—ã—á–∞–∂–Ω–æ–º —Ç—Ä–µ–Ω–∞–∂–µ—Ä–µ</option>
                        </optgroup>
                        <optgroup label="–ü–ª–µ—á–∏">
                            <option value="–ú–∞—Ö–∏ –Ω–∞ –ø–ª–µ—á–∏ —Å–æ —Å–≤–æ–±–æ–¥–Ω—ã–º –≤–µ—Å–æ–º">–ú–∞—Ö–∏ –Ω–∞ –ø–ª–µ—á–∏ —Å–æ —Å–≤–æ–±–æ–¥–Ω—ã–º –≤–µ—Å–æ–º</option>
                            <option value="–û—Ç–≤–µ–¥–µ–Ω–∏–µ –ø–ª–µ—á–∞ –≤ –±–ª–æ—á–Ω–æ–º —Ç—Ä–µ–Ω–∞–∂–µ—Ä–µ &quot;reverse fly&quot;">–û—Ç–≤–µ–¥–µ–Ω–∏–µ –ø–ª–µ—á–∞ –≤ –±–ª–æ—á–Ω–æ–º —Ç—Ä–µ–Ω–∞–∂–µ—Ä–µ "reverse fly"</option>
                        </optgroup>
                        <optgroup label="–ù–æ–≥–∏">
                            <option value="–Ø–≥–æ–¥–∏—á–Ω—ã–π –º–æ—Å—Ç –≤ —Ä—ã—á–∞–∂–Ω–æ–º —Ç—Ä–µ–Ω–∞–∂–µ—Ä–µ">–Ø–≥–æ–¥–∏—á–Ω—ã–π –º–æ—Å—Ç –≤ —Ä—ã—á–∞–∂–Ω–æ–º —Ç—Ä–µ–Ω–∞–∂–µ—Ä–µ</option>
                            <option value="–†–∞–∑–≥–∏–±–∞–Ω–∏–µ –±–µ–¥—Ä–∞ —Å—Ç–æ—è –≤ –∫—Ä–æ—Å—Å–æ–≤–µ—Ä–µ / —Ä—ã—á–∞–∂–Ω–æ–º —Ç—Ä–µ–Ω–∞–∂–µ—Ä–µ">–†–∞–∑–≥–∏–±–∞–Ω–∏–µ –±–µ–¥—Ä–∞ —Å—Ç–æ—è –≤ –∫—Ä–æ—Å—Å–æ–≤–µ—Ä–µ / —Ä—ã—á–∞–∂–Ω–æ–º —Ç—Ä–µ–Ω–∞–∂–µ—Ä–µ</option>
                            <option value="–ë–æ–ª–≥–∞—Ä—Å–∫–∏–µ –≤—ã–ø–∞–¥—ã —Å–æ —Å–≤–æ–±–æ–¥–Ω—ã–º –≤–µ—Å–æ–º / –≤ —Å–º–∏—Ç–µ">–ë–æ–ª–≥–∞—Ä—Å–∫–∏–µ –≤—ã–ø–∞–¥—ã —Å–æ —Å–≤–æ–±–æ–¥–Ω—ã–º –≤–µ—Å–æ–º / –≤ —Å–º–∏—Ç–µ</option>
                            <option value="–û—Ç–≤–µ–¥–µ–Ω–∏–µ –±–µ–¥—Ä–∞ —Å–∏–¥—è –≤ —Å–¥–≤–æ–µ–Ω–Ω–æ–º –±–ª–æ—á–Ω–æ–º —Ç—Ä–µ–Ω–∞–∂–µ—Ä–µ (–±–æ–ª—å—à–∞—è —è–≥–æ–¥–∏—á–Ω–∞—è)">–û—Ç–≤–µ–¥–µ–Ω–∏–µ –±–µ–¥—Ä–∞ —Å–∏–¥—è –≤ —Å–¥–≤–æ–µ–Ω–Ω–æ–º –±–ª–æ—á–Ω–æ–º —Ç—Ä–µ–Ω–∞–∂–µ—Ä–µ (–±–æ–ª—å—à–∞—è —è–≥–æ–¥–∏—á–Ω–∞—è)</option>
                            <option value="–û—Ç–≤–µ–¥–µ–Ω–∏–µ —Å –Ω–∞–∫–ª–æ–Ω–æ–º –≤–ø–µ—Ä–µ–¥ –±–µ–¥—Ä–∞ —Å–∏–¥—è –≤ —Å–¥–≤–æ–µ–Ω–Ω–æ–º –±–ª–æ—á–Ω–æ–º —Ç—Ä–µ–Ω–∞–∂–µ—Ä–µ (–º–∞–ª–∞—è –∏ —Å—Ä–µ–¥–Ω—è—è —è–≥–æ–¥–∏—á–Ω—ã–µ)">–û—Ç–≤–µ–¥–µ–Ω–∏–µ —Å –Ω–∞–∫–ª–æ–Ω–æ–º –≤–ø–µ—Ä–µ–¥ –±–µ–¥—Ä–∞ —Å–∏–¥—è –≤ —Å–¥–≤–æ–µ–Ω–Ω–æ–º –±–ª–æ—á–Ω–æ–º —Ç—Ä–µ–Ω–∞–∂–µ—Ä–µ (–º–∞–ª–∞—è –∏ —Å—Ä–µ–¥–Ω—è—è —è–≥–æ–¥–∏—á–Ω—ã–µ)</option>
                            <option value="–ü—Ä–∏—Å–µ–¥–∞–Ω–∏–µ –≤ –°–º–∏—Ç–µ">–ü—Ä–∏—Å–µ–¥–∞–Ω–∏–µ –≤ –°–º–∏—Ç–µ</option>
                        </optgroup>
                        <optgroup label="–°–ø–∏–Ω–∞">
                            <option value="–í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–∞—è —Ç—è–≥–∞ —Å–∏–¥—è">–í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–∞—è —Ç—è–≥–∞ —Å–∏–¥—è</option>
                            <option value="–ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–∞—è —Ç—è–≥–∞ —Ç—Ä–æ—Å—Å–æ–≤–∞—è –≤ –±–ª–æ—á–Ω–æ–º —Ç—Ä–µ–Ω–∞–∂–µ—Ä–µ">–ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–∞—è —Ç—è–≥–∞ —Ç—Ä–æ—Å—Å–æ–≤–∞—è –≤ –±–ª–æ—á–Ω–æ–º —Ç—Ä–µ–Ω–∞–∂–µ—Ä–µ</option>
                            <option value="–≠–∫—Å—Ç–µ–Ω–∑–∏—è –Ω–∞ –Ω–∞–∫–ª–æ–Ω–Ω–æ–π —Å–∫–∞–º—å–µ">–≠–∫—Å—Ç–µ–Ω–∑–∏—è –Ω–∞ –Ω–∞–∫–ª–æ–Ω–Ω–æ–π —Å–∫–∞–º—å–µ</option>
                        </optgroup>
                        <optgroup label="–ö–∞—Ä–¥–∏–æ">
                            <option value="–•–æ–¥—å–±–∞ –Ω–∞ –¥–æ—Ä–æ–∂–∫–µ —Å –Ω–∞–∫–ª–æ–Ω–æ–º 13-14">–•–æ–¥—å–±–∞ –Ω–∞ –¥–æ—Ä–æ–∂–∫–µ —Å –Ω–∞–∫–ª–æ–Ω–æ–º 13-14</option>
                        </optgroup>
                    </select>
                </div>

                <div class="sets-container" data-exercise-index="0">
                    <div class="set-form" data-set-index="0">
                        <div class="set-header">
                            <h5>–ü–æ–¥—Ö–æ–¥ 1</h5>
                            <button type="button" class="btn-remove-set remove-set-btn" style="display: none;" title="–£–¥–∞–ª–∏—Ç—å –ø–æ–¥—Ö–æ–¥">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
                                </svg>
                            </button>
                        </div>
                        <div class="form-row set-row">
                            <div class="form-group">
                                <label>–í–µ—Å (–∫–≥):</label>
                                <input type="number" name="weight_0_0" step="0.5" class="weight-input">
                            </div>
                            <div class="form-group">
                                <label>–ü–æ–≤—Ç–æ—Ä–µ–Ω–∏—è:</label>
                                <input type="number" name="reps_0_0" min="1" class="reps-input">
                            </div>
                            <div class="form-group set-timer-group">
                                <!-- –ö–Ω–æ–ø–∫–∞ –∑–∞–ø—É—Å–∫–∞ –ø–µ—Ä–µ—Ä—ã–≤–∞ -->
                                <button type="button" class="btn-set-rest start-set-rest-btn" data-exercise-index="0" data-set-index="0">
                                    <span class="rest-btn-icon">‚è±</span>
                                    <span class="rest-btn-text">–ü–µ—Ä–µ—Ä—ã–≤</span>
                                </button>
                                
                                <!-- –¢–∞–π–º–µ—Ä –ø–µ—Ä–µ—Ä—ã–≤–∞ (–∏–∑–Ω–∞—á–∞–ª—å–Ω–æ —Å–∫—Ä—ã—Ç) -->
                                <div class="set-rest-timer" style="display: none;">
                                    <div class="rest-timer-display">
                                        <span class="rest-timer-time">01:30</span>
                                    </div>
                                    <div class="rest-timer-controls">
                                        <button type="button" class="btn-timer-control btn-rest-pause">
                                            <svg class="timer-icon" viewBox="0 0 24 24" width="16" height="16">
                                                <path fill="currentColor" d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/>
                                            </svg>
                                        </button>
                                        <button type="button" class="btn-timer-control btn-rest-stop">
                                            <svg class="timer-icon" viewBox="0 0 24 24" width="16" height="16">
                                                <path fill="currentColor" d="M6 6h12v12H6z"/>
                                            </svg>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <button type="button" class="btn-animated btn-secondary add-set-btn" data-exercise-index="0">
                    <span class="btn-content">
                        <span class="btn-icon">+</span>
                        –î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥—Ö–æ–¥
                    </span>
                    <span class="btn-hover-effect"></span>
                </button>
            </div>
        </div>

        <div class="form-actions-full">
            <button type="button" id="add-exercise-btn" class="btn-animated btn-secondary btn-full">
                <span class="btn-content">
                    <span class="btn-icon">+</span>
                    –î–æ–±–∞–≤–∏—Ç—å —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ
                </span>
                <span class="btn-hover-effect"></span>
            </button>
            
            <!-- –¢–∞–π–º–µ—Ä —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ -->
            <div id="workout-timer-container" class="workout-timer-container" style="display: none;">
                <div class="workout-timer-content">
                    <div class="workout-timer-display">
                        <span id="workout-timer">00:00:00</span>
                        <div class="workout-timer-label">–í—Ä–µ–º—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏</div>
                    </div>
                    <div class="workout-timer-controls">
                        <button type="button" id="workout-pause-btn" class="btn-timer-control btn-timer-pause">
                            <svg class="timer-icon" viewBox="0 0 24 24" width="18" height="18">
                                <path fill="currentColor" d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/>
                            </svg>
                            <span class="btn-text">–ü–∞—É–∑–∞</span>
                        </button>
                        <button type="button" id="workout-reset-btn" class="btn-timer-control btn-timer-reset">
                            <svg class="timer-icon" viewBox="0 0 24 24" width="18" height="18">
                                <path fill="currentColor" d="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"/>
                            </svg>
                            <span class="btn-text">–°–±—Ä–æ—Å</span>
                        </button>
                        <button type="button" id="workout-stop-btn" class="btn-timer-control btn-timer-stop">
                            <svg class="timer-icon" viewBox="0 0 24 24" width="18" height="18">
                                <path fill="currentColor" d="M9 16h6v-6H9v6zM12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2z"/>
                            </svg>
                            <span class="btn-text">–ó–∞–≤–µ—Ä—à–∏—Ç—å</span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- –ó–∞–≤–µ—Ä—à–µ–Ω–Ω–∞—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ -->
            <div id="workout-completed-container" class="workout-timer-container workout-completed" style="display: none;">
                <div class="workout-timer-content">
                    <div class="workout-timer-display">
                        <span id="completed-workout-timer">00:00:00</span>
                        <div class="workout-completed-label">–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞</div>
                    </div>
                </div>
            </div>

            <button type="button" id="start-workout-timer-btn" class="btn-animated btn-warning btn-full">
                <span class="btn-content">
                    <span class="btn-icon">‚è±</span>
                    –ù–∞—á–∞—Ç—å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É
                </span>
                <span class="btn-hover-effect"></span>
            </button>
            <button type="submit" class="btn-animated btn-primary btn-full">
                <span class="btn-content">
                    <span class="btn-icon">üíæ</span>
                    –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É
                </span>
                <span class="btn-hover-effect"></span>
            </button>
        </div>
    </form>
</div>

<!-- –í—Å–ø–ª—ã–≤–∞—é—â–µ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –¥–ª—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π -->
<div id="suggestion-toast" class="toast" style="display: none;">
    <div class="toast-content">
        <div class="toast-icon">üí°</div>
        <div class="toast-message">
            <strong>–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è</strong>
            <span id="suggestion-toast-text"></span>
        </div>
        <div class="toast-actions">
            <button id="suggestion-toast-apply" class="btn-toast btn-toast-apply" style="display: none;">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
            <button id="suggestion-toast-close" class="btn-toast btn-toast-close">‚úï</button>
        </div>
    </div>
</div>

<style>
/* ===== –û–°–ù–û–í–ù–´–ï –°–¢–ò–õ–ò –¢–ê–ô–ú–ï–†–ê –¢–†–ï–ù–ò–†–û–í–ö–ò ===== */
.workout-timer-container {
    background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
    border-radius: 12px;
    padding: 18px 20px;
    margin: 12px 0;
    box-shadow: 0 8px 25px rgba(0,0,0,0.2);
    border: none;
    animation: slideDown 0.5s ease-out;
    border: 2px solid rgba(255,255,255,0.1);
    min-height: auto;
}

.workout-completed {
    background: linear-gradient(135deg, #2e7d32 0%, #4caf50 100%) !important;
    border-color: rgba(255,255,255,0.2);
}

.workout-timer-content {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 20px;
}

.workout-timer-display {
    text-align: center;
    color: white;
    flex: 1;
}

.workout-timer-display span {
    font-size: 2.2rem;
    font-weight: 700;
    font-family: 'Courier New', monospace;
    text-shadow: 0 2px 10px rgba(0,0,0,0.3);
    display: block;
    margin-bottom: 2px;
    color: #ffffff;
    line-height: 1;
}

.workout-timer-label {
    font-size: 0.85rem;
    opacity: 0.9;
    font-weight: 500;
    color: #e0e0e0;
    margin-top: 2px;
}

.workout-completed-label {
    font-size: 1rem;
    font-weight: 600;
    color: #e8f5e9;
    margin-top: 5px;
    text-shadow: 0 1px 3px rgba(0,0,0,0.3);
}

.workout-timer-controls {
    display: flex;
    gap: 8px;
}

/* ===== –°–¢–ò–õ–ò –ö–ù–û–ü–û–ö –¢–ê–ô–ú–ï–†–ê ===== */
.btn-timer-control {
    display: flex;
    align-items: center;
    gap: 6px;
    padding: 10px 14px;
    border: none;
    border-radius: 50px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    box-shadow: 0 4px 15px rgba(0,0,0,0.2);
    position: relative;
    overflow: hidden;
    font-size: 0.85rem;
}

.btn-timer-control::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
    transition: left 0.5s;
}

.btn-timer-control:hover::before {
    left: 100%;
}

.btn-timer-control:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(0,0,0,0.3);
}

.btn-timer-control:active {
    transform: translateY(0);
}

.btn-timer-pause {
    background: linear-gradient(135deg, #ffd700, #ffa500);
    color: #333;
}

.btn-timer-reset {
    background: linear-gradient(135deg, #6c757d, #5a6268);
    color: white;
}

.btn-timer-stop {
    background: linear-gradient(135deg, #ff6b6b, #ee5a52);
    color: white;
}

.timer-icon {
    flex-shrink: 0;
}

.btn-text {
    font-size: 0.85rem;
}

/* ===== –°–¢–ò–õ–ò –¢–ê–ô–ú–ï–†–ê –ü–ï–†–ï–†–´–í–ê –í –ü–û–î–•–û–î–ê–• ===== */
.set-timer-group {
    position: relative;
    min-width: 140px;
}

.btn-set-rest {
    display: flex;
    align-items: center;
    gap: 6px;
    padding: 10px 15px;
    background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
    color: white;
    border: none;
    border-radius: 8px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    width: 100%;
    justify-content: center;
    box-shadow: 0 2px 10px rgba(30, 60, 114, 0.4);
}

.btn-set-rest:hover {
    transform: translateY(-1px);
    box-shadow: 0 4px 15px rgba(30, 60, 114, 0.6);
}

.rest-btn-icon {
    font-size: 1rem;
}

.rest-btn-text {
    font-size: 0.85rem;
}

.set-rest-timer {
    display: flex;
    align-items: center;
    gap: 8px;
    background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
    padding: 8px 12px;
    border-radius: 8px;
    color: white;
    animation: timerSlideIn 0.3s ease-out;
    box-shadow: 0 4px 15px rgba(30, 60, 114, 0.4);
    border: 1px solid rgba(255,255,255,0.1);
}

.rest-timer-display {
    flex: 1;
    text-align: center;
}

.rest-timer-time {
    font-family: 'Courier New', monospace;
    font-weight: 700;
    font-size: 1rem;
    text-shadow: 0 1px 3px rgba(0,0,0,0.3);
    color: #ffffff;
}

.rest-timer-controls {
    display: flex;
    gap: 4px;
}

.rest-timer-controls .btn-timer-control {
    padding: 6px 8px;
    min-width: auto;
    border-radius: 6px;
}

.rest-timer-controls .timer-icon {
    width: 14px;
    height: 14px;
}

/* ===== –£–õ–£–ß–®–ï–ù–ù–´–ï –°–¢–ò–õ–ò –ö–ù–û–ü–û–ö –° –ê–ù–ò–ú–ê–¶–ò–ï–ô ===== */
.btn-animated {
    position: relative;
    overflow: hidden;
    border: none;
    border-radius: 10px;
    cursor: pointer;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    width: 100%;
    margin-bottom: 12px;
    padding: 0;
    background: transparent;
}

.btn-content {
    position: relative;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    padding: 14px;
    font-size: 1rem;
    font-weight: 600;
    z-index: 2;
    transition: all 0.3s ease;
}

.btn-hover-effect {
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
    transition: left 0.6s ease;
    z-index: 1;
}

.btn-animated:hover .btn-hover-effect {
    left: 100%;
}

/* –ê–Ω–∏–º–∞—Ü–∏–∏ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —Ç–∏–ø–æ–≤ –∫–Ω–æ–ø–æ–∫ */
.btn-secondary {
    background: linear-gradient(135deg, #6c757d, #5a6268);
    color: white;
}

.btn-secondary:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 25px rgba(108, 117, 125, 0.4);
    background: linear-gradient(135deg, #5a6268, #495057);
}

.btn-warning {
    background: linear-gradient(135deg, #ffd700, #ffa500);
    color: #333;
}

.btn-warning:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 25px rgba(255, 215, 0, 0.4);
    background: linear-gradient(135deg, #ffa500, #ff8c00);
}

.btn-primary {
    background: linear-gradient(135deg, #1e3c72, #2a5298);
    color: white;
}

.btn-primary:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 25px rgba(30, 60, 114, 0.4);
    background: linear-gradient(135deg, #2a5298, #1e3c72);
}

/* –°–ø–µ—Ü–∏—Ñ–∏—á–µ—Å–∫–∏–µ —Å—Ç–∏–ª–∏ –¥–ª—è –∫–Ω–æ–ø–∫–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø–æ–¥—Ö–æ–¥–∞ */
.add-set-btn {
    width: auto;
    margin-top: 10px;
    margin-bottom: 0;
}

/* ===== –°–¢–ò–õ–ò –£–ü–†–ê–í–õ–ï–ù–ò–Ø –£–ü–†–ê–ñ–ù–ï–ù–ò–Ø–ú–ò –ò –ü–û–î–•–û–î–ê–ú–ò ===== */
.exercise-form {
    position: relative;
    background: #f8f9fa;
    border-radius: 10px;
    padding: 20px;
    margin-bottom: 20px;
    border: 1px solid #e9ecef;
}

.exercise-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
    position: relative;
}

.exercise-header h4 {
    margin: 0;
    color: #333;
    font-size: 1.3rem;
}

.btn-remove-exercise {
    position: absolute;
    top: -8px;
    right: -8px;
    background: transparent;
    color: #dc3545;
    border: none;
    width: 24px;
    height: 24px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.3s ease;
    opacity: 0.7;
    border-radius: 0;
    box-shadow: none;
}

.btn-remove-exercise:hover {
    transform: scale(1.2);
    opacity: 1;
    background: transparent;
    color: #c82333;
}

.exercise-controls {
    margin-bottom: 15px;
    display: flex;
    gap: 10px;
}

.set-form {
    background: white;
    border-radius: 8px;
    padding: 15px;
    margin-bottom: 10px;
    border: 1px solid #e9ecef;
    position: relative;
}

.set-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 10px;
}

.set-header h5 {
    margin: 0;
    color: #495057;
    font-size: 1rem;
}

.btn-remove-set {
    background: transparent;
    color: #6c757d;
    border: none;
    width: 20px;
    height: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.3s ease;
    opacity: 0.6;
    border-radius: 0;
}

.btn-remove-set:hover {
    background: transparent;
    transform: scale(1.2);
    opacity: 1;
    color: #495057;
}

/* ===== –°–¢–ò–õ–ò –í–°–ü–õ–´–í–ê–Æ–©–ò–• –£–í–ï–î–û–ú–õ–ï–ù–ò–ô ===== */
.toast {
    position: fixed;
    top: 20px;
    right: 20px;
    background: white;
    border-radius: 12px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.2);
    z-index: 10000;
    max-width: 400px;
    animation: toastSlideIn 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
    border-left: 4px solid #4facfe;
    overflow: hidden;
}

.toast-content {
    display: flex;
    align-items: center;
    padding: 15px;
    gap: 12px;
}

.toast-icon {
    font-size: 1.5rem;
    flex-shrink: 0;
}

.toast-message {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: 4px;
}

.toast-message strong {
    color: #333;
    font-size: 0.9rem;
}

.toast-message span {
    color: #666;
    font-size: 0.85rem;
    line-height: 1.3;
}

.toast-actions {
    display: flex;
    gap: 8px;
    flex-shrink: 0;
}

.btn-toast {
    padding: 6px 12px;
    border: none;
    border-radius: 6px;
    font-size: 0.8rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s ease;
}

.btn-toast-apply {
    background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
    color: white;
}

.btn-toast-apply:hover {
    transform: translateY(-1px);
    box-shadow: 0 2px 8px rgba(79, 172, 254, 0.4);
}

.btn-toast-close {
    background: #f8f9fa;
    color: #666;
    border: 1px solid #e9ecef;
}

.btn-toast-close:hover {
    background: #e9ecef;
}

/* ===== –û–°–ù–û–í–ù–´–ï –°–¢–ò–õ–ò –§–û–†–ú–´ ===== */
.form-row.set-row {
    display: grid;
    grid-template-columns: 1fr 1fr auto;
    gap: 15px;
    align-items: end;
}

.btn-full {
    width: 100%;
}

.form-actions-full {
    margin-top: 25px;
}

/* ===== –ê–ù–ò–ú–ê–¶–ò–ò ===== */
@keyframes slideDown {
    from {
        opacity: 0;
        transform: translateY(-20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

@keyframes timerSlideIn {
    from {
        opacity: 0;
        transform: scale(0.8) translateX(10px);
    }
    to {
        opacity: 1;
        transform: scale(1) translateX(0);
    }
}

@keyframes toastSlideIn {
    from {
        opacity: 0;
        transform: translateX(100px) scale(0.8);
    }
    to {
        opacity: 1;
        transform: translateX(0) scale(1);
    }
}

@keyframes toastSlideOut {
    from {
        opacity: 1;
        transform: translateX(0) scale(1);
    }
    to {
        opacity: 0;
        transform: translateX(100px) scale(0.8);
    }
}

.toast-hide {
    animation: toastSlideOut 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55) forwards;
}

/* ===== –ê–î–ê–ü–¢–ò–í–ù–û–°–¢–¨ ===== */
@media (max-width: 768px) {
    .form-row.set-row {
        grid-template-columns: 1fr;
        gap: 10px;
    }
    
    .workout-timer-content {
        flex-direction: column;
        text-align: center;
        gap: 12px;
    }
    
    .workout-timer-controls {
        width: 100%;
        justify-content: center;
        flex-wrap: wrap;
    }
    
    .btn-timer-control {
        flex: 1;
        min-width: 100px;
        justify-content: center;
    }
    
    .toast {
        left: 10px;
        right: 10px;
        max-width: none;
    }
    
    .set-rest-timer {
        flex-direction: column;
        gap: 6px;
    }
    
    .rest-timer-controls {
        width: 100%;
        justify-content: center;
    }
    
    .workout-timer-display span {
        font-size: 1.8rem;
    }
    
    .exercise-form {
        padding: 15px;
    }
    
    .btn-remove-exercise {
        top: -6px;
        right: -6px;
        width: 22px;
        height: 22px;
    }
}

/* –°—Ç–∏–ª—å –¥–ª—è –ø—É–ª—å—Å–∞—Ü–∏–∏ —Ç–∞–π–º–µ—Ä–∞ */
.timer-pulse {
    animation: pulse 1s infinite;
}

@keyframes pulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.05); }
    100% { transform: scale(1); }
}

/* –°—Ç–∏–ª—å –¥–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ç–∞–π–º–µ—Ä–∞ */
.timer-complete {
    background: linear-gradient(135deg, #ff6b6b, #ee5a52) !important;
    animation: completePulse 0.5s infinite;
}

@keyframes completePulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.1); }
}

/* –í—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ –∫–Ω–æ–ø–∫–∏ "–ù–∞—á–∞—Ç—å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É" –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º –ø–æ—è–≤–ª–µ–Ω–∏–∏ */
#start-workout-timer-btn {
    display: flex !important;
    justify-content: center;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    let exerciseCount = 1;
    const container = document.getElementById('exercises-container');
    const addExerciseBtn = document.getElementById('add-exercise-btn');

    // ===== –¢–ê–ô–ú–ï–† –¢–†–ï–ù–ò–†–û–í–ö–ò =====
    let workoutTimerInterval = null;
    let workoutTimeElapsed = 0;
    let isWorkoutTimerRunning = false;
    
    const workoutTimerContainer = document.getElementById('workout-timer-container');
    const workoutCompletedContainer = document.getElementById('workout-completed-container');
    const workoutTimerDisplay = document.getElementById('workout-timer');
    const completedWorkoutTimerDisplay = document.getElementById('completed-workout-timer');
    const startWorkoutTimerBtn = document.getElementById('start-workout-timer-btn');
    const workoutPauseBtn = document.getElementById('workout-pause-btn');
    const workoutResetBtn = document.getElementById('workout-reset-btn');
    const workoutStopBtn = document.getElementById('workout-stop-btn');
    const durationMinutesInput = document.getElementById('duration_minutes');
    const workoutNameInput = document.getElementById('workout_name');
    const dateInput = document.getElementById('date');

    let lastWorkoutTime = 0;
    
    function updateWorkoutTimerDisplay() {
        const hours = Math.floor(workoutTimeElapsed / 3600);
        const minutes = Math.floor((workoutTimeElapsed % 3600) / 60);
        const seconds = workoutTimeElapsed % 60;
        
        const timeString = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        
        // –ê–Ω–∏–º–∞—Ü–∏—è –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å–µ–∫—É–Ω–¥
        if (workoutTimeElapsed !== lastWorkoutTime) {
            if (workoutTimerDisplay) {
                workoutTimerDisplay.classList.add('digit-change');
                setTimeout(() => {
                    workoutTimerDisplay.classList.remove('digit-change');
                }, 300);
            }
            if (completedWorkoutTimerDisplay) {
                completedWorkoutTimerDisplay.classList.add('digit-change');
                setTimeout(() => {
                    completedWorkoutTimerDisplay.classList.remove('digit-change');
                }, 300);
            }
        }
        
        if (workoutTimerDisplay) workoutTimerDisplay.textContent = timeString;
        if (completedWorkoutTimerDisplay) completedWorkoutTimerDisplay.textContent = timeString;
        
        lastWorkoutTime = workoutTimeElapsed;
    }

    function startWorkoutTimer() {
        if (isWorkoutTimerRunning) return;
        
        isWorkoutTimerRunning = true;
        workoutTimerInterval = setInterval(() => {
            workoutTimeElapsed++;
            updateWorkoutTimerDisplay();
        }, 1000);
    }

    function pauseWorkoutTimer() {
        if (!isWorkoutTimerRunning) return;
        
        clearInterval(workoutTimerInterval);
        isWorkoutTimerRunning = false;
        workoutPauseBtn.innerHTML = '<svg class="timer-icon" viewBox="0 0 24 24" width="18" height="18"><path fill="currentColor" d="M8 5v14l11-7z"/></svg><span class="btn-text">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</span>';
    }

    function resumeWorkoutTimer() {
        if (isWorkoutTimerRunning) return;
        
        isWorkoutTimerRunning = true;
        workoutTimerInterval = setInterval(() => {
            workoutTimeElapsed++;
            updateWorkoutTimerDisplay();
        }, 1000);
        workoutPauseBtn.innerHTML = '<svg class="timer-icon" viewBox="0 0 24 24" width="18" height="18"><path fill="currentColor" d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/></svg><span class="btn-text">–ü–∞—É–∑–∞</span>';
    }

    function resetWorkoutTimer() {
        clearInterval(workoutTimerInterval);
        isWorkoutTimerRunning = false;
        workoutTimeElapsed = 0;
        updateWorkoutTimerDisplay();
        
        // –°–∫—Ä—ã–≤–∞–µ–º —Ç–∞–π–º–µ—Ä –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É "–ù–∞—á–∞—Ç—å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É"
        workoutTimerContainer.style.display = 'none';
        workoutCompletedContainer.style.display = 'none';
        startWorkoutTimerBtn.style.display = 'flex';
        
        // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –ø–æ–ª–µ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
        durationMinutesInput.value = '';
    }

    function completeWorkoutTimer() {
        clearInterval(workoutTimerInterval);
        isWorkoutTimerRunning = false;
        
        // –ó–∞–ø–∏—Å—ã–≤–∞–µ–º –≤—Ä–µ–º—è –≤ –ø–æ–ª–µ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ (–≤ –º–∏–Ω—É—Ç–∞—Ö)
        const durationMinutes = Math.ceil(workoutTimeElapsed / 60);
        durationMinutesInput.value = durationMinutes;
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–π —Ç–∞–π–º–µ—Ä
        workoutTimerContainer.style.display = 'none';
        workoutCompletedContainer.style.display = 'block';
        startWorkoutTimerBtn.style.display = 'none';
        
        updateWorkoutTimerDisplay();
    }

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Ç–∞–π–º–µ—Ä–∞ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏
    startWorkoutTimerBtn.addEventListener('click', function() {
        this.style.display = 'none';
        workoutTimerContainer.style.display = 'block';
        workoutCompletedContainer.style.display = 'none';
        startWorkoutTimer();
    });

    workoutPauseBtn.addEventListener('click', function() {
        if (isWorkoutTimerRunning) {
            pauseWorkoutTimer();
        } else {
            resumeWorkoutTimer();
        }
    });

    workoutResetBtn.addEventListener('click', resetWorkoutTimer);
    workoutStopBtn.addEventListener('click', completeWorkoutTimer);

    // ===== –¢–ê–ô–ú–ï–†–´ –ü–ï–†–ï–†–´–í–ê –î–õ–Ø –ü–û–î–•–û–î–û–í =====
    let activeRestTimer = null;

    container.addEventListener('click', function(e) {
        // –ó–∞–ø—É—Å–∫ —Ç–∞–π–º–µ—Ä–∞ –ø–µ—Ä–µ—Ä—ã–≤–∞
        if (e.target.closest('.start-set-rest-btn')) {
            const restBtn = e.target.closest('.start-set-rest-btn');
            const exerciseIndex = restBtn.getAttribute('data-exercise-index');
            const setIndex = restBtn.getAttribute('data-set-index');
            
            // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π –∞–∫—Ç–∏–≤–Ω—ã–π —Ç–∞–π–º–µ—Ä
            if (activeRestTimer) {
                stopRestTimer(activeRestTimer.container, activeRestTimer.button);
            }
            
            startSetRestTimer(exerciseIndex, setIndex, restBtn);
        }
        
        // –ü–∞—É–∑–∞/–ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ —Ç–∞–π–º–µ—Ä–∞ –ø–µ—Ä–µ—Ä—ã–≤–∞
        if (e.target.closest('.btn-rest-pause')) {
            const pauseBtn = e.target.closest('.btn-rest-pause');
            const timerContainer = pauseBtn.closest('.set-rest-timer');
            toggleRestTimer(timerContainer);
        }
        
        // –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ç–∞–π–º–µ—Ä–∞ –ø–µ—Ä–µ—Ä—ã–≤–∞
        if (e.target.closest('.btn-rest-stop')) {
            const stopBtn = e.target.closest('.btn-rest-stop');
            const timerContainer = stopBtn.closest('.set-rest-timer');
            const restBtn = timerContainer.previousElementSibling;
            stopRestTimer(timerContainer, restBtn);
        }
    });

    function startSetRestTimer(exerciseIndex, setIndex, restBtn) {
        const restTime = parseInt(document.getElementById('default_rest_time').value) || 90;
        let timeLeft = restTime;
        let isRestTimerRunning = true;

        // –°–∫—Ä—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–∞–π–º–µ—Ä
        restBtn.style.display = 'none';
        const timerContainer = restBtn.nextElementSibling;
        timerContainer.style.display = 'flex';
        const timerDisplay = timerContainer.querySelector('.rest-timer-time');
        const pauseBtn = timerContainer.querySelector('.btn-rest-pause');
        let lastRestTime = timeLeft;

        function updateRestTimerDisplay() {
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            const timeString = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            
            // –ê–Ω–∏–º–∞—Ü–∏—è –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –≤—Ä–µ–º–µ–Ω–∏
            if (timeLeft !== lastRestTime) {
                timerDisplay.classList.add('digit-change');
                setTimeout(() => {
                    timerDisplay.classList.remove('digit-change');
                }, 300);
            }
            
            timerDisplay.textContent = timeString;
            lastRestTime = timeLeft;

            // –ú–µ–Ω—è–µ–º —Ü–≤–µ—Ç –ø—Ä–∏ –º–∞–ª–æ–º –≤—Ä–µ–º–µ–Ω–∏
            if (timeLeft <= 10) {
                timerDisplay.style.color = '#ffeb3b';
                timerDisplay.classList.add('timer-pulse');
            } else if (timeLeft <= 30) {
                timerDisplay.style.color = '#ff9800';
                timerDisplay.classList.remove('timer-pulse');
            } else {
                timerDisplay.style.color = '#ffffff';
                timerDisplay.classList.remove('timer-pulse');
            }
        }

        updateRestTimerDisplay();

        const timerInterval = setInterval(() => {
            if (isRestTimerRunning) {
                timeLeft--;
                updateRestTimerDisplay();

                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    timerContainer.classList.add('timer-complete');
                    playTimerSound();
                    showTimerNotification('–ü–µ—Ä–µ—Ä—ã–≤ –∑–∞–∫–æ–Ω—á–∏–ª—Å—è! –ü—Ä–∏—Å—Ç—É–ø–∞–π—Ç–µ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –ø–æ–¥—Ö–æ–¥—É.');
                    
                    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∫—Ä—ã–≤–∞–µ–º —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
                    setTimeout(() => {
                        stopRestTimer(timerContainer, restBtn);
                    }, 3000);
                }
            }
        }, 1000);

        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ —Ç–∞–π–º–µ—Ä–∞
        timerContainer.dataset.timerInterval = timerInterval;
        timerContainer.dataset.timeLeft = timeLeft;
        timerContainer.dataset.isRunning = 'true';
        
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π —Ç–∞–π–º–µ—Ä
        activeRestTimer = {
            container: timerContainer,
            button: restBtn,
            interval: timerInterval
        };
    }

    function toggleRestTimer(timerContainer) {
        const isRunning = timerContainer.dataset.isRunning === 'true';
        const pauseBtn = timerContainer.querySelector('.btn-rest-pause');
        
        if (isRunning) {
            timerContainer.dataset.isRunning = 'false';
            pauseBtn.innerHTML = '<svg class="timer-icon" viewBox="0 0 24 24" width="16" height="16"><path fill="currentColor" d="M8 5v14l11-7z"/></svg>';
        } else {
            timerContainer.dataset.isRunning = 'true';
            pauseBtn.innerHTML = '<svg class="timer-icon" viewBox="0 0 24 24" width="16" height="16"><path fill="currentColor" d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/></svg>';
        }
    }

    function stopRestTimer(timerContainer, restBtn) {
        const timerInterval = timerContainer.dataset.timerInterval;
        if (timerInterval) {
            clearInterval(parseInt(timerInterval));
        }
        
        timerContainer.style.display = 'none';
        restBtn.style.display = 'flex';
        timerContainer.classList.remove('timer-complete');
        
        // –û—á–∏—â–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π —Ç–∞–π–º–µ—Ä
        if (activeRestTimer && activeRestTimer.container === timerContainer) {
            activeRestTimer = null;
        }
    }

    function playTimerSound() {
        try {
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.frequency.value = 800;
            oscillator.type = 'sine';
            
            gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 1);
            
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 1);
        } catch (e) {
            console.log('Audio not supported');
        }
    }

    function showTimerNotification(message) {
        if (Notification.permission === 'granted') {
            new Notification('–¢–∞–π–º–µ—Ä', {
                body: message,
                icon: '/static/favicon.ico'
            });
        }
    }

    // ===== –£–õ–£–ß–®–ï–ù–ù–û–ï –ü–†–ï–î–°–ö–ê–ó–ê–ù–ò–ï –í–ï–°–ê =====
    const suggestionToast = document.getElementById('suggestion-toast');
    const suggestionToastText = document.getElementById('suggestion-toast-text');
    const suggestionToastApply = document.getElementById('suggestion-toast-apply');
    const suggestionToastClose = document.getElementById('suggestion-toast-close');
    let toastTimeout = null;

    function showSuggestionToast(message, exerciseIndex, suggestionData) {
        // –û—á–∏—â–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π —Ç–∞–π–º–∞—É—Ç
        if (toastTimeout) {
            clearTimeout(toastTimeout);
        }
        
        // –°–∫—Ä—ã–≤–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–µ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
        suggestionToast.classList.remove('toast-hide');
        suggestionToast.style.display = 'none';
        
        // –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ
        suggestionToastText.textContent = message;

        // –ï—Å–ª–∏ –µ—Å—Ç—å –¥–∞–Ω–Ω—ã–µ –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É "–ü—Ä–∏–º–µ–Ω–∏—Ç—å"
        if (suggestionData) {
            suggestionToastApply.style.display = 'block';
            suggestionToastApply.onclick = function() {
                applySuggestion(exerciseIndex, suggestionData);
                hideSuggestionToast();
            };
        } else {
            suggestionToastApply.style.display = 'none';
        }

        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —Å –∞–Ω–∏–º–∞—Ü–∏–µ–π
        setTimeout(() => {
            suggestionToast.style.display = 'block';
        }, 50);

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∫—Ä—ã–≤–∞–µ–º —á–µ—Ä–µ–∑ 6 —Å–µ–∫—É–Ω–¥
        toastTimeout = setTimeout(() => {
            hideSuggestionToast();
        }, 6000);
    }

    function hideSuggestionToast() {
        suggestionToast.classList.add('toast-hide');
        setTimeout(() => {
            suggestionToast.style.display = 'none';
            suggestionToast.classList.remove('toast-hide');
        }, 500);
    }

    function getWeightSuggestion(exerciseType, exerciseIndex) {
        if (!exerciseType) {
            showSuggestionToast('–í—ã–±–µ—Ä–∏—Ç–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏', exerciseIndex);
            return;
        }
        
        fetch(`/api/weight-prediction/${encodeURIComponent(exerciseType)}`)
            .then(response => response.json())
            .then(data => {
                if (data.suggestion) {
                    showSuggestionToast(
                        `${data.suggestion.reason} - –í–µ—Å: ${data.suggestion.weight}–∫–≥, –ü–æ–≤—Ç–æ—Ä–µ–Ω–∏—è: ${data.suggestion.reps}`,
                        exerciseIndex,
                        data.suggestion
                    );
                } else {
                    showSuggestionToast(data.message || '–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—é', exerciseIndex);
                }
            })
            .catch(error => {
                console.error('Error getting suggestion:', error);
                showSuggestionToast('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏', exerciseIndex);
            });
    }

    function applySuggestion(exerciseIndex, suggestion) {
        const weightInput = document.querySelector(`input[name="weight_${exerciseIndex}_0"]`);
        const repsInput = document.querySelector(`input[name="reps_${exerciseIndex}_0"]`);

        if (weightInput) weightInput.value = suggestion.weight;
        if (repsInput) repsInput.value = suggestion.reps;
    }

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –≤—Å–ø–ª—ã–≤–∞—é—â–µ–≥–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
    suggestionToastClose.addEventListener('click', hideSuggestionToast);

    // ===== –£–ü–†–ê–í–õ–ï–ù–ò–ï –§–û–†–ú–û–ô =====
    function createNewExercise() {
        const firstExercise = container.querySelector('.exercise-form');
        const newExercise = firstExercise.cloneNode(true);
        
        const newIndex = exerciseCount;
        exerciseCount++;
        
        newExercise.setAttribute('data-exercise-index', newIndex);
        newExercise.querySelector('h4').textContent = `–£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ ${newIndex + 1}`;
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –∏–º–µ–Ω–∞ –ø–æ–ª–µ–π
        const exerciseSelect = newExercise.querySelector('select');
        exerciseSelect.name = `exercise_type_${newIndex}`;
        exerciseSelect.value = '';
        exerciseSelect.classList.add('exercise-select');
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏
        const suggestionBtn = newExercise.querySelector('.get-suggestion-btn');
        suggestionBtn.setAttribute('data-exercise-index', newIndex);
        
        const setsContainer = newExercise.querySelector('.sets-container');
        setsContainer.setAttribute('data-exercise-index', newIndex);
        
        const addSetBtn = newExercise.querySelector('.add-set-btn');
        addSetBtn.setAttribute('data-exercise-index', newIndex);
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –∏–º–µ–Ω–∞ –ø–æ–ª–µ–π –≤ –ø–µ—Ä–≤–æ–º –ø–æ–¥—Ö–æ–¥–µ
        const firstSet = newExercise.querySelector('.set-form');
        firstSet.setAttribute('data-set-index', 0);
        firstSet.querySelector('h5').textContent = '–ü–æ–¥—Ö–æ–¥ 1';
        
        const weightInput = firstSet.querySelector('input[name^="weight_"]');
        const repsInput = firstSet.querySelector('input[name^="reps_"]');
        const restBtn = firstSet.querySelector('.start-set-rest-btn');
        
        if (weightInput) {
            weightInput.name = `weight_${newIndex}_0`;
            weightInput.value = '';
        }
        if (repsInput) {
            repsInput.name = `reps_${newIndex}_0`;
            repsInput.value = '';
        }
        if (restBtn) {
            restBtn.setAttribute('data-exercise-index', newIndex);
            restBtn.setAttribute('data-set-index', 0);
        }
        
        // –û—Å—Ç–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤—ã–π –ø–æ–¥—Ö–æ–¥
        const setForms = newExercise.querySelectorAll('.set-form');
        for (let i = 1; i < setForms.length; i++) {
            setForms[i].remove();
        }
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É —É–¥–∞–ª–µ–Ω–∏—è –¥–ª—è –≤—Å–µ—Ö —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π –∫—Ä–æ–º–µ –ø–µ—Ä–≤–æ–≥–æ
        if (newIndex > 0) {
            newExercise.querySelector('.remove-exercise-btn').style.display = 'flex';
        }
        
        // –°–∫—Ä—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫–∏ —É–¥–∞–ª–µ–Ω–∏—è –ø–æ–¥—Ö–æ–¥–æ–≤ –≤ –ø–µ—Ä–≤–æ–º –ø–æ–¥—Ö–æ–¥–µ
        const removeSetBtns = newExercise.querySelectorAll('.remove-set-btn');
        if (removeSetBtns.length > 0) {
            removeSetBtns[0].style.display = 'none';
        }
        
        return newExercise;
    }
    
    addExerciseBtn.addEventListener('click', function() {
        const newExercise = createNewExercise();
        container.appendChild(newExercise);
    });
    
    container.addEventListener('click', function(e) {
        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–¥—Ö–æ–¥–∞
        if (e.target.closest('.add-set-btn')) {
            const exerciseIndex = e.target.closest('.add-set-btn').getAttribute('data-exercise-index');
            const setsContainer = document.querySelector(`.sets-container[data-exercise-index="${exerciseIndex}"]`);
            const setForms = setsContainer.querySelectorAll('.set-form');
            const setCount = setForms.length;
            
            const newSet = setForms[0].cloneNode(true);
            newSet.setAttribute('data-set-index', setCount);
            newSet.querySelector('h5').textContent = `–ü–æ–¥—Ö–æ–¥ ${setCount + 1}`;
            
            const inputs = newSet.querySelectorAll('input');
            inputs.forEach(input => {
                const name = input.name.replace(/_(\d+)_(\d+)$/, `_${exerciseIndex}_${setCount}`);
                input.name = name;
                input.value = '';
            });
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É –ø–µ—Ä–µ—Ä—ã–≤–∞
            const restBtn = newSet.querySelector('.start-set-rest-btn');
            if (restBtn) {
                restBtn.setAttribute('data-exercise-index', exerciseIndex);
                restBtn.setAttribute('data-set-index', setCount);
            }
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É —É–¥–∞–ª–µ–Ω–∏—è –¥–ª—è –≤—Å–µ—Ö –ø–æ–¥—Ö–æ–¥–æ–≤ –∫—Ä–æ–º–µ –ø–µ—Ä–≤–æ–≥–æ
            const removeSetBtn = newSet.querySelector('.remove-set-btn');
            if (removeSetBtn) {
                removeSetBtn.style.display = 'flex';
            }
            
            setsContainer.appendChild(newSet);
        }
        
        // –£–¥–∞–ª–µ–Ω–∏–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è
        if (e.target.closest('.remove-exercise-btn')) {
            if (container.children.length > 1) {
                e.target.closest('.exercise-form').remove();
            }
        }
        
        // –£–¥–∞–ª–µ–Ω–∏–µ –ø–æ–¥—Ö–æ–¥–∞
        if (e.target.closest('.remove-set-btn')) {
            const setForm = e.target.closest('.set-form');
            const setsContainer = setForm.parentElement;
            if (setsContainer.children.length > 1) {
                setForm.remove();
            }
        }
        
        // –ó–∞–ø—Ä–æ—Å –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è –≤–µ—Å–∞
        if (e.target.closest('.get-suggestion-btn')) {
            const exerciseIndex = e.target.closest('.get-suggestion-btn').getAttribute('data-exercise-index');
            const exerciseSelect = document.querySelector(`select[name="exercise_type_${exerciseIndex}"]`);
            getWeightSuggestion(exerciseSelect.value, exerciseIndex);
        }
    });
    
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤—ã–±–æ—Ä–∞ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è
    container.addEventListener('change', function(e) {
        if (e.target.classList.contains('exercise-select')) {
            const exerciseIndex = e.target.name.split('_')[2];
            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ –ø—Ä–∏ –≤—ã–±–æ—Ä–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è
            if (e.target.value) {
                getWeightSuggestion(e.target.value, exerciseIndex);
            }
        }
    });

    // –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º—ã –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π
    document.getElementById('workout-session-form').addEventListener('submit', function(e) {
        const durationValue = durationMinutesInput.value.trim();
        const workoutNameValue = workoutNameInput.value.trim();
        const dateValue = dateInput.value;
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ –µ—Å–ª–∏ –ø—É—Å—Ç–æ–µ
        if (!workoutNameValue) {
            const dateObj = new Date(dateValue);
            const formattedDate = dateObj.toLocaleDateString('ru-RU');
            workoutNameInput.value = `–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ ${formattedDate}`;
        }
        
        // –ï—Å–ª–∏ —Ç–∞–π–º–µ—Ä –Ω–µ –±—ã–ª –∑–∞–ø—É—â–µ–Ω –∏ –ø–æ–ª–µ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –ø—É—Å—Ç–æ–µ
        if (!durationValue && workoutTimeElapsed === 0) {
            e.preventDefault();
            alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ –≤ –º–∏–Ω—É—Ç–∞—Ö –∏–ª–∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–∞–π–º–µ—Ä —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏.');
            durationMinutesInput.focus();
            return;
        }
        
        // –ï—Å–ª–∏ —Ç–∞–π–º–µ—Ä –±—ã–ª –∑–∞–ø—É—â–µ–Ω, –Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—Ä—É—á–Ω—É—é –∏–∑–º–µ–Ω–∏–ª –∑–Ω–∞—á–µ–Ω–∏–µ, –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ä—É—á–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
        if (durationValue && workoutTimeElapsed > 0) {
            // –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ–º, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ö–æ—á–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä—É—á–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –≤–º–µ—Å—Ç–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ
            const autoDuration = Math.ceil(workoutTimeElapsed / 60);
            if (parseInt(durationValue) !== autoDuration) {
                const confirmUseManual = confirm(
                    `–¢–∞–π–º–µ—Ä —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç ${autoDuration} –º–∏–Ω—É—Ç. –í—ã —Ö–æ—Ç–∏—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä—É—á–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ (${durationValue} –º–∏–Ω—É—Ç) –≤–º–µ—Å—Ç–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ?`
                );
                if (!confirmUseManual) {
                    durationMinutesInput.value = autoDuration;
                }
            }
        }
    });

    // –ó–∞–ø—Ä–æ—Å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –Ω–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
    if ('Notification' in window && Notification.permission === 'default') {
        Notification.requestPermission();
    }

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    updateWorkoutTimerDisplay();
});
</script>
{% endblock %}