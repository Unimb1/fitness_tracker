{% extends "base.html" %}

{% block title %}–î–æ–±–∞–≤–∏—Ç—å —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ - –§–∏—Ç–Ω–µ—Å –¢—Ä–µ–∫–µ—Ä{% endblock %}

{% block content %}
<div class="custom-exercise-page">
    <div class="page-header">
        <h1>‚ûï –î–æ–±–∞–≤–∏—Ç—å —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ</h1>
        <a href="{{ url_for('custom_exercises') }}" class="btn-secondary">
            <span>‚Üê</span>
            <span>–ù–∞–∑–∞–¥</span>
        </a>
    </div>

    <div class="form-container">
        <form method="POST" id="custom-exercise-form">
                
                <div class="form-group">
                    <label for="name">
                        <span class="label-icon">üí™</span>
                        –ù–∞–∑–≤–∞–Ω–∏–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è
                    </label>
                    <input 
                        type="text" 
                        id="name" 
                        name="name" 
                        placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ñ–∏–º —à—Ç–∞–Ω–≥–∏ –ª–µ–∂–∞" 
                        required 
                        maxlength="100"
                        autocomplete="off">
                    <div class="input-feedback" id="name-feedback"></div>
                    <small class="form-hint">–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è (–º–∞–∫—Å. 100 —Å–∏–º–≤–æ–ª–æ–≤)</small>
                </div>
                
                <div class="form-group">
                    <label for="muscle_group">
                        <span class="label-icon">üéØ</span>
                        –ì—Ä—É–ø–ø–∞ –º—ã—à—Ü
                    </label>
                    <div class="muscle-group-buttons">
                        <button type="button" class="muscle-group-btn" data-group="–ì—Ä—É–¥—å">
                            <span>üí™</span>
                            <span>–ì—Ä—É–¥—å</span>
                        </button>
                        <button type="button" class="muscle-group-btn" data-group="–†—É–∫–∏">
                            <span>üí™</span>
                            <span>–†—É–∫–∏</span>
                        </button>
                        <button type="button" class="muscle-group-btn" data-group="–ü–ª–µ—á–∏">
                            <span>üí™</span>
                            <span>–ü–ª–µ—á–∏</span>
                        </button>
                        <button type="button" class="muscle-group-btn" data-group="–ù–æ–≥–∏">
                            <span>ü¶µ</span>
                            <span>–ù–æ–≥–∏</span>
                        </button>
                        <button type="button" class="muscle-group-btn" data-group="–°–ø–∏–Ω–∞">
                            <span>üèãÔ∏è</span>
                            <span>–°–ø–∏–Ω–∞</span>
                        </button>
                        <button type="button" class="muscle-group-btn" data-group="–ö–∞—Ä–¥–∏–æ">
                            <span>üèÉ</span>
                            <span>–ö–∞—Ä–¥–∏–æ</span>
                        </button>
                    </div>
                    <select id="muscle_group" name="muscle_group" required style="display: none;">
                        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –≥—Ä—É–ø–ø—É –º—ã—à—Ü</option>
                        <option value="–ì—Ä—É–¥—å">–ì—Ä—É–¥—å</option>
                        <option value="–†—É–∫–∏">–†—É–∫–∏</option>
                        <option value="–ü–ª–µ—á–∏">–ü–ª–µ—á–∏</option>
                        <option value="–ù–æ–≥–∏">–ù–æ–≥–∏</option>
                        <option value="–°–ø–∏–Ω–∞">–°–ø–∏–Ω–∞</option>
                        <option value="–ö–∞—Ä–¥–∏–æ">–ö–∞—Ä–¥–∏–æ</option>
                    </select>
                    <small class="form-hint">–í—ã–±–µ—Ä–∏—Ç–µ —Ü–µ–ª–µ–≤—É—é –≥—Ä—É–ø–ø—É –º—ã—à—Ü</small>
                </div>
                
                <div class="form-group">
                    <label for="met_value">
                        <span class="label-icon">üî•</span>
                        MET –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç
                    </label>
                    <div class="met-input-wrapper">
                        <input 
                            type="number" 
                            id="met_value" 
                            name="met_value" 
                            placeholder="5.0" 
                            value="5.0" 
                            step="0.1" 
                            min="1.0" 
                            max="20.0" 
                            required>
                        <div class="met-presets">
                            <span class="met-preset-label">–ë—ã—Å—Ç—Ä—ã–π –≤—ã–±–æ—Ä:</span>
                            <button type="button" class="met-preset-btn" data-met="3.0">–õ–µ–≥–∫–æ (3.0)</button>
                            <button type="button" class="met-preset-btn" data-met="5.0">–°—Ä–µ–¥–Ω–µ (5.0)</button>
                            <button type="button" class="met-preset-btn" data-met="6.0">–ò–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ (6.0)</button>
                            <button type="button" class="met-preset-btn" data-met="8.0">–û—á–µ–Ω—å (8.0)</button>
                        </div>
                    </div>
                    <small class="form-hint">MET (Metabolic Equivalent) - –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ –∫–∞–ª–æ—Ä–∏–π. –û–±—ã—á–Ω–æ –æ—Ç 3.0 –¥–æ 8.0</small>
                </div>
                
                <div class="form-group">
                    <label for="description">
                        <span class="label-icon">üìù</span>
                        –û–ø–∏—Å–∞–Ω–∏–µ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
                    </label>
                    <textarea 
                        id="description" 
                        name="description" 
                        placeholder="–û–ø–∏—à–∏—Ç–µ —Ç–µ—Ö–Ω–∏–∫—É –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è, —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –∏ —Ç.–¥." 
                        rows="4"
                        maxlength="1000"></textarea>
                    <div class="char-counter">
                        <span id="char-count">0</span> / 1000 —Å–∏–º–≤–æ–ª–æ–≤
                    </div>
                    <small class="form-hint">–ú–∞–∫—Å–∏–º—É–º 1000 —Å–∏–º–≤–æ–ª–æ–≤</small>
                </div>
            
            <div class="form-actions">
                <button type="submit" class="btn-primary btn-submit" id="submit-btn">
                    <span>üíæ</span>
                    <span>–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ</span>
                </button>
                <a href="{{ url_for('custom_exercises') }}" class="btn-secondary">
                    <span>–û—Ç–º–µ–Ω–∞</span>
                </a>
            </div>
        </form>
    </div>
</div>

<style>
.custom-exercise-page {
    max-width: 900px;
    margin: 0 auto;
    padding: 1rem;
}

.page-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 2rem;
    flex-wrap: wrap;
    gap: 1rem;
}

.page-header h1 {
    font-size: 2rem;
    font-weight: 800;
    color: var(--text-primary);
    margin: 0;
    background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

.form-container {
    background: var(--card-bg);
    padding: 2rem;
    border-radius: var(--radius-xl);
    box-shadow: var(--shadow-lg);
    border: 1px solid var(--border-color);
}


.form-group {
    margin-bottom: 1.5rem;
}

.form-group label {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin-bottom: 0.75rem;
    font-weight: 600;
    color: var(--text-primary);
    font-size: 0.95rem;
}

.label-icon {
    font-size: 1.1rem;
}

.form-hint {
    display: block;
    margin-top: 0.5rem;
    color: var(--text-secondary);
    font-size: 0.8rem;
}

.input-feedback {
    margin-top: 0.5rem;
    font-size: 0.85rem;
    min-height: 1.2rem;
}

.input-feedback.error {
    color: var(--error-color);
}

.input-feedback.success {
    color: var(--success-color);
}

/* –ö–Ω–æ–ø–∫–∏ –≤—ã–±–æ—Ä–∞ –≥—Ä—É–ø–ø—ã –º—ã—à—Ü */
.muscle-group-buttons {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 0.75rem;
    margin-bottom: 1rem;
}

.muscle-group-btn {
    background: linear-gradient(135deg, #f8fafc, white);
    border: 2px solid var(--border-color);
    border-radius: var(--radius-md);
    padding: 1rem;
    cursor: pointer;
    transition: var(--transition);
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.5rem;
    font-weight: 600;
    color: var(--text-primary);
    min-height: var(--touch-target-min);
    pointer-events: auto;
    z-index: 1;
    position: relative;
}

.muscle-group-btn:hover {
    border-color: var(--primary-color);
    box-shadow: var(--shadow-md);
    transform: translateY(-2px);
}

.muscle-group-btn.active {
    background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
    color: white;
    border-color: var(--primary-color);
    box-shadow: var(--shadow-md);
}

.muscle-group-btn:active {
    transform: translateY(0);
}

.muscle-group-btn span:first-child {
    font-size: 1.5rem;
}

/* MET input wrapper */
.met-input-wrapper {
    position: relative;
}

.met-presets {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin-top: 0.75rem;
    flex-wrap: wrap;
}

.met-preset-label {
    font-size: 0.85rem;
    color: var(--text-secondary);
    font-weight: 500;
    margin-right: 0.25rem;
}

.met-preset-btn {
    background: var(--light-bg);
    border: 1px solid var(--border-color);
    border-radius: var(--radius-sm);
    padding: 0.5rem 0.75rem;
    font-size: 0.85rem;
    font-weight: 600;
    color: var(--text-primary);
    cursor: pointer;
    transition: var(--transition);
    pointer-events: auto;
    z-index: 1;
    position: relative;
}

.met-preset-btn:hover {
    background: var(--primary-color);
    color: white;
    border-color: var(--primary-color);
}

.met-preset-btn:active {
    transform: scale(0.95);
}

textarea {
    width: 100%;
    padding: 0.875rem 1rem;
    border: 2px solid var(--border-color);
    border-radius: var(--radius-md);
    font-size: 1rem;
    transition: var(--transition);
    background: var(--light-bg);
    color: var(--text-primary);
    font-family: inherit;
    resize: vertical;
    min-height: 100px;
}

textarea:focus {
    outline: none;
    border-color: var(--primary-color);
    box-shadow: 0 0 0 3px rgba(17, 24, 39, 0.1);
    background: white;
}

.char-counter {
    text-align: right;
    margin-top: 0.5rem;
    font-size: 0.8rem;
    color: var(--text-secondary);
}

.char-counter.warning {
    color: var(--warning-color);
}

.char-counter.error {
    color: var(--error-color);
}

.form-actions {
    display: flex;
    gap: 1rem;
    margin-top: 2rem;
    flex-wrap: wrap;
}

.form-actions .btn-primary,
.form-actions .btn-secondary {
    flex: 1;
    min-width: 150px;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    padding: 1rem;
    font-size: 1rem;
    font-weight: 600;
    min-height: var(--touch-target-min);
    pointer-events: auto;
    cursor: pointer;
    z-index: 1;
    position: relative;
    text-decoration: none;
}

.btn-submit {
    background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
    color: white;
    border: none;
}

.btn-submit:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-lg);
}

.btn-submit:active {
    transform: translateY(0);
}

@media (max-width: 768px) {
    .custom-exercise-page {
        padding: 0.75rem;
    }
    
    .form-container {
        padding: 1.5rem;
    }
    
    .page-header h1 {
        font-size: 1.5rem;
    }
    
    .muscle-group-buttons {
        grid-template-columns: repeat(2, 1fr);
    }
    
    .form-actions {
        flex-direction: column;
    }
    
    .form-actions .btn-primary,
    .form-actions .btn-secondary {
        width: 100%;
    }
}

@media (max-width: 480px) {
    .muscle-group-buttons {
        grid-template-columns: repeat(2, 1fr);
    }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('custom-exercise-form');
    const nameInput = document.getElementById('name');
    const muscleGroupSelect = document.getElementById('muscle_group');
    const metInput = document.getElementById('met_value');
    const descriptionTextarea = document.getElementById('description');
    const charCount = document.getElementById('char-count');
    const nameFeedback = document.getElementById('name-feedback');
    const submitBtn = document.getElementById('submit-btn');
    
    // –í—ã–±–æ—Ä –≥—Ä—É–ø–ø—ã –º—ã—à—Ü —á–µ—Ä–µ–∑ –∫–Ω–æ–ø–∫–∏
    document.querySelectorAll('.muscle-group-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            const group = this.dataset.group;
            
            // –£–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —É –≤—Å–µ—Ö
            document.querySelectorAll('.muscle-group-btn').forEach(b => {
                b.classList.remove('active');
            });
            
            // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é
            this.classList.add('active');
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ –≤ select
            muscleGroupSelect.value = group;
            
            // –í–∏–∑—É–∞–ª—å–Ω–∞—è –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å
            this.style.transform = 'scale(0.95)';
            setTimeout(() => {
                this.style.transform = '';
            }, 150);
        });
    });
    
    // –ë—ã—Å—Ç—Ä—ã–π –≤—ã–±–æ—Ä MET
    document.querySelectorAll('.met-preset-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            const met = this.dataset.met;
            metInput.value = met;
            
            // –í–∏–∑—É–∞–ª—å–Ω–∞—è –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å
            this.style.transform = 'scale(0.95)';
            setTimeout(() => {
                this.style.transform = '';
            }, 150);
        });
    });
    
    // –°—á–µ—Ç—á–∏–∫ —Å–∏–º–≤–æ–ª–æ–≤ –¥–ª—è –æ–ø–∏—Å–∞–Ω–∏—è
    descriptionTextarea.addEventListener('input', function() {
        const length = this.value.length;
        charCount.textContent = length;
        
        if (length > 900) {
            charCount.classList.add('error');
            charCount.classList.remove('warning');
        } else if (length > 800) {
            charCount.classList.add('warning');
            charCount.classList.remove('error');
        } else {
            charCount.classList.remove('warning', 'error');
        }
    });
    
    // –í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞–∑–≤–∞–Ω–∏—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
    nameInput.addEventListener('input', function() {
        const value = this.value.trim();
        const feedback = nameFeedback;
        
        if (value.length === 0) {
            feedback.textContent = '';
            feedback.className = 'input-feedback';
            return;
        }
        
        if (value.length < 3) {
            feedback.textContent = '–ù–∞–∑–≤–∞–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –Ω–µ –º–µ–Ω–µ–µ 3 —Å–∏–º–≤–æ–ª–æ–≤';
            feedback.className = 'input-feedback error';
        } else if (value.length > 100) {
            feedback.textContent = '–ù–∞–∑–≤–∞–Ω–∏–µ —Å–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω–æ–µ (–º–∞–∫—Å. 100 —Å–∏–º–≤–æ–ª–æ–≤)';
            feedback.className = 'input-feedback error';
        } else {
            feedback.textContent = '‚úì –ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ';
            feedback.className = 'input-feedback success';
        }
    });
    
    // –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º—ã –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π
    form.addEventListener('submit', function(e) {
        const name = nameInput.value.trim();
        const muscleGroup = muscleGroupSelect.value;
        const met = parseFloat(metInput.value);
        
        if (!name || name.length < 3) {
            e.preventDefault();
            nameInput.focus();
            nameFeedback.textContent = '–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è (–º–∏–Ω–∏–º—É–º 3 —Å–∏–º–≤–æ–ª–∞)';
            nameFeedback.className = 'input-feedback error';
            return;
        }
        
        if (!muscleGroup) {
            e.preventDefault();
            alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –≥—Ä—É–ø–ø—É –º—ã—à—Ü');
            return;
        }
        
        if (!met || met < 1 || met > 20) {
            e.preventDefault();
            alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π MET –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç (–æ—Ç 1.0 –¥–æ 20.0)');
            metInput.focus();
            return;
        }
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
        submitBtn.disabled = true;
        submitBtn.innerHTML = '<span>‚è≥</span><span>–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ...</span>';
    });
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å—á–µ—Ç—á–∏–∫–∞ —Å–∏–º–≤–æ–ª–æ–≤
    charCount.textContent = descriptionTextarea.value.length;
});
</script>
{% endblock %}
